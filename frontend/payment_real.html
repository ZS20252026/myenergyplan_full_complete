<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Secure Payment</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  form { max-width: 400px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
  label { display: block; margin-top: 10px; }
  input { width: 100%; padding: 8px; box-sizing: border-box; }
  button { margin-top: 15px; padding: 10px 20px; font-size: 16px; }
</style>
</head>
<body>

<h2>Make a Payment</h2>
<form id="payment-form">
  <label for="name">Name</label>
  <input type="text" id="name" required>

  <label for="email">Email</label>
  <input type="email" id="email" required>

  <label for="amount">Amount (USD)</label>
  <input type="number" id="amount" value="50" required>

  <button type="button" id="pay-btn">Pay with 2Checkout</button>
</form>

<!-- Include 2Checkout SDK (sandbox or production) -->
<script src="https://sandbox.2checkout.com/checkout/api/checkout.js"></script> <!-- Change to www.2checkout.com for production -->

<script>
  document.getElementById('pay-btn').onclick = () => {
    // Load your environment (sandbox or production)
    TCO.loadPubKey('sandbox'); // Change to 'www' for production

    const amount = document.getElementById('amount').value;
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;

    TCO.requestPay({
      // Set your order details
      amount: amount,
      currency: 'USD',
      merchantOrderId: 'order_' + Date.now(), // Unique ID
      customer: {
        firstName: name,
        email: email
      }
    }, function (result) {
      if (result.response.responseCode === 'APPROVED') {
        // Send token and order info to backend
        fetch('/api/payments/create-order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            amount: amount,
            token: result.response.token,
            description: 'Order Payment'
          })
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert('Payment successful!');
            // Optionally redirect to success page
            window.location.href = '/frontend/success.html';
          } else {
            alert('Payment processing failed on server.');
          }
        })
        .catch(() => {
          alert('Server error during payment.');
        });
      } else {
        alert('Payment not approved.');
      }
    });
  };
</script>

</body>
</html>
